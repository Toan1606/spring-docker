package com.codedecode.demo.service;

import java.util.Base64;
import java.util.HashSet;
import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.server.ResponseStatusException;

import com.codedecode.demo.dto.LoginRequestDTO;
import com.codedecode.demo.dto.LoginResponseDTO;
import com.codedecode.demo.dto.RecruiterRegisterDTO;
import com.codedecode.demo.dto.RegisterRequestDTO;
import com.codedecode.demo.entity.Address;
import com.codedecode.demo.entity.ApplicationUserRole;
import com.codedecode.demo.entity.CV;
import com.codedecode.demo.entity.CandidateProfileSaved;
import com.codedecode.demo.entity.DesiredJob;
import com.codedecode.demo.entity.Role;
import com.codedecode.demo.entity.Salary;
import com.codedecode.demo.entity.User;
import com.codedecode.demo.entity.WorkingForm;
import com.codedecode.demo.entity.YearOfExperience;
import com.codedecode.demo.exception.UserNotFoundException;
import com.codedecode.demo.repository.UserRepository;
import com.codedecode.demo.utils.ExceptionMessage;

@Service
@Transactional
public class AuthService {
	private final UserRepository userRepository;

	private final PasswordEncoder passwordEncoder;

	private final String accessTokenSecret;

	private final String refreshTokenSecret;

	private final AddressService addressService;

	private final RoleService roleService;

	private final CandidateProfileSavedService candidateProfileSavedService;

	@Autowired
	public AuthService(UserRepository userRepository, PasswordEncoder passwordEncoder, 
			@Value("${application.security.access-token-secret}") String accessTokenSecret,
			@Value("${application.security.refresh-token-secret}") String refreshTokenSecret
	, AddressService addressService, RoleService roleService, CandidateProfileSavedService candidateProfileSavedService) {
		this.userRepository = userRepository;
		this.passwordEncoder = passwordEncoder;
		this.accessTokenSecret = accessTokenSecret;
		this.refreshTokenSecret = refreshTokenSecret;
		this.addressService = addressService;
		this.roleService = roleService;
		this.candidateProfileSavedService = candidateProfileSavedService;
	}
	
	public User register(RegisterRequestDTO registerRequestDTO) {
		String fullName = registerRequestDTO.getFullName();
		String email = registerRequestDTO.getEmail();
		String password = registerRequestDTO.getPassword();
		Long provinceId = registerRequestDTO.getProvinceId();
		Long cityId = registerRequestDTO.getCityId();
		String phoneNumber = registerRequestDTO.getPhoneNumber();
		
//		if (!Objects.equals(password, confirmPassword)) {
//			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, ExceptionMessage.PASSWORD_DON_NOT_MATCH.getErrorMessage());
//		}
		
		Address address = addressService.findAddressByProvinceAndCity(provinceId, cityId);
		
		String encodePassword = passwordEncoder.encode(password);
		Role role = roleService.findRoleByName(ApplicationUserRole.ROLE_CANDIDATE.name());
		Set<Role> roles = new HashSet<Role>();
		roles.add(role);
		CV cv = new CV();
		CandidateProfileSaved candidateProfileSaved = new CandidateProfileSaved();
		DesiredJob desiredJob = new DesiredJob();
		
		User user = new User();
		user.setRoles(roles);
		user.setAddress(address);
		user.setName(fullName);
		user.setEmail(email);
		user.setPassword(encodePassword);
		user.setPhone(phoneNumber);
		user.setCv(cv);
		user.setImages("data:image/jpeg;base64,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AAAANMAAAAAAAAAAAAPPPPPPPPPPPPPPIAAAAAAAAAAAENIAAAAAAEOIAAAAAAAAAAAEPPPPPPPPPPPPPPCAAAAAAAAAAAAEPIAAAAEFLAAAAAAAAAAAABPPPPPPPPPPPPPKCAAAAAAABDBACAONPNOOJANDABAAAAAAAAABFPPPPPPPPPPPPKIAAAAAAAKHKMKHADPABNNELPJNCAAAAAAAAEFPPPPPPPPPPPPPIAAAAAAABCAMHBJMNEIDMJNMFDPKAAAAAAAEPPPPPPPPPPPPPPCAAAAAAAAAAAAEDMOMENMDIAAAAAAAAAAAABPPPPPPPPPPPPPPAAAAAAAAAAABNNCIAAAAEBOOCAAAAAAAAAAAPPPPPPPPPPPPPPPAAAAAAAAABJIIAAAAAAAAEEGCAAAAAAAAAPPPPPPPPPPPPPPPLCAAAAAAAAJMIAAAAAAAAAAEMGAAAAAAAABHPPPPPPPPPPPPPPPIAAAAAAAEDAAAAAAAAAAAAAADIAAAAAAAEPPPPPPPPPPPPPPPPGAAAAAAADKAAAAAAAAAAAAAAFDAAAAAAAJPPPPPPPPPPPPPPPPPAAAAAABHKAAAAAAAAAAAAAAFLCAAAAAAPPPPPPPPPPPPPPPPPPPCAAAAFLAAAAAAAAAAAAAAAAHKAAAABPPPPPPPPPPPPPPPPPPPPJAAAABOAAAAAAAAAAAAAAAANCAAAAGPPPPPPPPPPPPPPPPPPPPPAAAAAEAAAAAAAAAAAAAAAAIAAAAAPPPPPPPPPPPPPPPPPPPPPPLLAAAAAAAAAAAAAAAAAAAAAAAAGHPPPPPPPPPPPPPPPPPPPPPPPLAAAAAAAAAAAAAAAAAAAAAAAAHPPPPPPPPPPPPPPPPPPPPPPPPPPLCAAAAAAAAAAAAAAAAAABHPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPAAAAAAAAAAAAAAAAAAPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPGBCAAAAAAAAAABCLPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPLPACBBCCBAPHPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPDDPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP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");;
		
		desiredJob.setUser(user);	
		user.setDesiredJob(desiredJob);
		
		User rs = userRepository.save(user);
		candidateProfileSaved.setUser(rs);
		candidateProfileSavedService.saveCandidateProfileSaved(candidateProfileSaved);
	
		return rs;
	}
	
	public User recruiterRegister(RecruiterRegisterDTO registerRequestDTO) {
		String fullName = registerRequestDTO.getFullName();
		String email = registerRequestDTO.getEmail();
		String password = registerRequestDTO.getPassword();		
		
		CandidateProfileSaved candidateProfileSaved = new CandidateProfileSaved();
		
		String encodePassword = passwordEncoder.encode(password);
		Role role = roleService.findRoleByName(ApplicationUserRole.ROLE_RECRUITER.name());
		Set<Role> roles = new HashSet<Role>();
		roles.add(role);
		
		User user = new User();
		user.setRoles(roles);
		user.setName(fullName);
		user.setEmail(email);
		user.setPassword(encodePassword);
		user.setDesiredJob(new DesiredJob());
		
		User rs = userRepository.save(user);
		candidateProfileSaved.setUser(rs);
		candidateProfileSavedService.saveCandidateProfileSaved(candidateProfileSaved);
		
		return rs;
	}
	
	public JwtUtil login(LoginRequestDTO loginResponse) {
		String email = loginResponse.getEmail();
		String password = loginResponse.getPassword(); 
		// find user by email
		User user = userRepository.findByEmail(email);
		
		if (!passwordEncoder.matches(password, user.getPassword())) {
			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "invalid credentials");
		}
		
		return JwtUtil.of(email, accessTokenSecret);
	}
	
	public User getUserFromToken(String authorizationHeader) {
		String[] chunks = authorizationHeader.split("\\.");
		Base64.Decoder decoder = Base64.getUrlDecoder();
		String payload = new String(decoder.decode(chunks[1]));
		String userIdCharacter = payload.split(",")[0];
		Long userId = Long.parseLong(Character.toString(userIdCharacter.charAt(userIdCharacter.length() - 1)));
		
		User user = userRepository.findById(userId).orElseThrow(() -> new UserNotFoundException(ExceptionMessage.USER_NOT_FOUND.getErrorMessage()));
		
		return user;
	}
	
	public LoginResponseDTO checkLogin(LoginRequestDTO loginResponse) {
		String email = loginResponse.getEmail();
		String password = loginResponse.getPassword(); 
		// find user by email
		User user = userRepository.findByEmail(email);
		
		if (!passwordEncoder.matches(password, user.getPassword())) {
			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "invalid credentials");
		}
		
		return LoginResponseDTO.of(email, accessTokenSecret, refreshTokenSecret, user);
	}
	
	public LoginResponseDTO refreshAccess(String refreshToken) {
		String email = JwtUtil.getSubject(refreshToken, refreshTokenSecret);
		User user = userRepository.findByEmail(email);
		LoginResponseDTO loginResponse = LoginResponseDTO.of(email, accessTokenSecret, JwtUtil.of(refreshToken), user);
		return loginResponse;
	}
}
